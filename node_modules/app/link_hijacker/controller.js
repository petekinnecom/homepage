var $ = require('jquery');
var terminal = require('app/terminal/model');
var WorkQueue = require('app/utils/work_queue');

function Controller(){
  
  $(document).on('click', 'a', hijack.bind(this));
  this.hijacking = false;

}

//private, must be bound

var hijack = function(event) {
  if (this.hijacking || ! event.target.dataset.input) {
    return;
  }
  event.preventDefault();

  $('body').addClass('is-hijacking-link');
  this.hijacking = true;

  var chars, string, queue;

  queue = new WorkQueue(100);
  chars = event.target.dataset.input.split('');
  string = "";

  chars.forEach(function(char){
    string = [string, char].join("");
    queue.enqueue(terminal.setInput.bind(terminal, string));
  });

  queue.enqueue(terminal.run.bind(terminal, string));
  queue.enqueue(doneHijacking.bind(this));
};

var doneHijacking = function(){
  this.hijacking = false;
  $('body').removeClass('is-hijacking-link');
};


module.exports = Controller;
