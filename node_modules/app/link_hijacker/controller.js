$ = require('jquery');
terminal = require('app/terminal/model');

function Controller(){
  
  $(document).on('click', 'a', hijack);

  window.terminal = terminal;
}

var hijack = function(event) {
  event.preventDefault();
  var chars = event.target.dataset.input.split('');

  var string = "";
  chars.forEach(function(char){
    string = [string, char].join("");
    console.log('enqueuing: '+string);
    enqueue(terminal.setInput.bind(terminal, string));
  });
  enqueue(terminal.run.bind(terminal));
  work();
};

var queue = [];

var enqueue = function(fn){
  queue.push(fn);
};

var work = function(){
  console.log('work');

  if(queue.length === 0){
    return;
  }

  queue[0]();
  queue = queue.slice(1, queue.length);
  setTimeout(work, 100);
};

module.exports = Controller;
