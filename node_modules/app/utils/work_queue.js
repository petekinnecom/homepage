
function WorkQueue(timer){
  this.queue = [];
  this.timer = timer;
  this.finsihed = false;
  work.call(this);
}

WorkQueue.prototype.enqueue = function(fn){
  this.queue.push(fn);
};

WorkQueue.prototype.done = function(){

  var markFinished = function(){
    this.finished = true;
  };

  this.enqueue(markFinished.bind(this));
};

var getDelay = function(){
  if (typeof this.timer === 'function') {
    return this.timer();
  }
  return this.timer;
};

var work = function(){
  if(this.queue.length !== 0){
    this.queue[0]();
    this.queue = this.queue.slice(1, this.queue.length);
  }

  if (!this.finished) {
    setTimeout(work.bind(this), getDelay.call(this));
  }
};


module.exports = WorkQueue;
