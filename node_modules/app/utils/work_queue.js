
function WorkQueue(timer){
  this.queue = [];
  this.timer = timer;
  this.finsihed = false;
}

WorkQueue.prototype.enqueue = function(fn){
  this.push(fn);
};

WorkQueue.prototype.push = function(fn){
  this.queue.push(fn);
  if (this.queue.length === 1) {
    doWork.call(this);
  }
};

var getDelay = function(){
  if (typeof this.timer === 'function') {
    return this.timer();
  }
  return this.timer;
};

var work = function(){
  if(this.queue.length !== 0){
    this.queue[0]();
    this.queue = this.queue.slice(1, this.queue.length);
  }

  if (this.queue.length !== 0) {
    doWork.call(this);
  }
};

var doWork = function(){
  setTimeout(work.bind(this), getDelay.call(this));
};

module.exports = WorkQueue;
