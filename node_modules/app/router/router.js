Parser = require('app/router/parser');
Commander = require('app/router/commander');
terminal = require('app/terminal/model');

var environment = 'local';
var resources = [
  'articles',
];

function Router(controllers){
  this.parser = new Parser(environment, resources);

  this.rootResource = controllers.root;
  delete controllers.root;

  this.controllers = controllers;
  window.addEventListener("hashchange", this.routeEvent.bind(this));

  this.route(window.location.href);
  new Commander(this);
}

Router.prototype.routeEvent = function(event){
  this.route(event.newURL);
};

Router.prototype.route = function(url){
  try {
    var resource = this.parser.parse(url);
    this.controllers[resource.name].load(resource.id);
  }
  catch(e) {
    this.push(this.rootResource);
    terminal.log('Routing to default article');
  }

};

Router.prototype.push = function(resource){
  var path = this.parser.construct(resource);
  window.location.hash = path;
};

module.exports = Router;

