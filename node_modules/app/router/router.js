Parser = require('app/router/parser');

var environment = 'local';
var resources = [
  'articles',
];

function Router(controllers){
  this.parser = new Parser(environment, resources);

  this.rootResource = controllers.root;
  delete controllers.root;

  this.controllers = controllers;
  window.addEventListener("hashchange", this.routeEvent.bind(this));

  this.route(window.location.href);
}

Router.prototype.routeEvent = function(event){
  this.route(event.newURL);
};

Router.prototype.route = function(url){
  try {
    var resource = this.parser.parse(url);
    this.controllers[resource.name].load(resource.id);
  }
  catch(e) {
    console.log(e);
    this.push(this.rootResource);
  }

};

Router.prototype.push = function(resource){
  var path = this.parser.construct(resource);
  window.location.hash = path;
};

module.exports = Router;

