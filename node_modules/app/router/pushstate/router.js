"use strict";
var Parser = require('app/router/pushstate/parser');
var terminal = require('app/terminal/model');

var environment = 'local';
var resources = [
  'pages',
];

function Router(controllers){
  this.parser = new Parser(environment, resources);

  this.rootResource = controllers.root;
  delete controllers.root;

  this.controllers = controllers;

  this.route(window.location.href);
}

Router.prototype.routeEvent = function(event){
  this.route(event.newURL);
};

Router.prototype.route = function(url){
  try {
    var resource = this.parser.parse(url);
    this.controllers[resource.name].load(resource.id);
  }
  catch(e) {
    this.push(this.rootResource);
    terminal.log('Routing to default page');
  }

};

Router.prototype.push = function(resource){
  var path = this.parser.construct(resource);
  //window.location = path;
  console.log('routing to: ' + path);
  //window.location.hash = path;
};

module.exports = Router;
