var Processor = require('app/terminal/processor');
var terminal = require('app/terminal/model');

function Commander(router){
  var processor = new Processor('adventure');

  processor.registerCommand({
    matcher: /.*/,
    fn: function(input, deferred){
      terminal.log('you typed: ' + input);

      if (input=='q'){
        terminal.warn('closing');
        deferred.resolve(false);
        return false;
      }

      setTimeout(function(){
        terminal.warn('async!');
        deferred.resolve(processor);
      }, 1000);

      return 'async';
    },
  });

  var beginAdventure = function(input, deferred){
    terminal.log('beginning adventure.');
    deferred.resolve(processor);
    return 'async';
  };

  terminal.registerCommand({
    matcher: "adventure",
    fn: beginAdventure,
  });
}

module.exports = new Commander();
