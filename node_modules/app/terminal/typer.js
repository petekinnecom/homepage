var WorkQueue = require('app/utils/work_queue');
var terminal = require('app/terminal/model');
var $ = require('jquery');

var defaultDelay = 100;

//options:
// delay: milliseconds
// interrupt: boolean
var type = function(input, options){
  var queue, accumulator, deferred;

  options = (options || {});
  queue = new WorkQueue(options.delay || defaultDelay);
  deferred = $.Deferred();

  if (options.interrupt !== false){
    terminal.interrupt();
  }

  accumulator = "";
  input.split('').forEach(function(char){
    accumulator = [accumulator, char].join("");
    queue.enqueue(terminal.setChars.bind(terminal, accumulator));
  });

  queue.enqueue(terminal.run.bind(terminal));
  queue.enqueue(deferred.resolve.bind(deferred));

  return deferred.promise();
};

module.exports = {
  type: type,
};
