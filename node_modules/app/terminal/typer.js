var WorkQueue = require('app/utils/work_queue');
var terminal = require('app/terminal/model');
var $ = require('jquery');

var defaultDelay = 100;

var type = function(input, delay){
  var queue, accumulator, deferred;
  queue = new WorkQueue(delay || defaultDelay);
  deferred = $.Deferred();

  accumulator = "";
  input.split('').forEach(function(char){
    accumulator = [accumulator, char].join("");
    queue.enqueue(terminal.setChars.bind(terminal, accumulator));
  });

  queue.enqueue(terminal.run.bind(terminal));
  queue.enqueue(deferred.resolve.bind(deferred));

  return deferred.promise();
};

module.exports = {
  type: type,
};
