var WorkQueue = require('app/utils/work_queue');

var defaultDelay = 100;

// Because this is delegated to from the terminal,
// we can't just require the terminal here.  So,
// we pass it in.

//options:
// delay: milliseconds
// interrupt: boolean
var type = function(terminal, input, options){
  var queue, accumulator, deferred;

  options = (options || {});
  queue = new WorkQueue(options.delay || defaultDelay);
  deferred = $.Deferred();

  if (options.interrupt !== false){
    terminal.interrupt();
  }

  accumulator = "";
  input.split('').forEach(function(char){
    accumulator = [accumulator, char].join("");
    queue.enqueue(terminal.setChars.bind(terminal, accumulator));
  });

  queue.enqueue(terminal.run.bind(terminal));
  queue.enqueue(deferred.resolve.bind(deferred));

  return deferred.promise();
};

module.exports = {
  type: type,
};
