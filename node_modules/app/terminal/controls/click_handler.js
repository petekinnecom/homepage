"use strict";

var terminal = require('app/terminal/model');
var TerminalTogglerCommand = require('app/terminal/commands/terminal_toggler');

var toggle = function(bool){
  this.enabled = bool;
};

function ClickHandler(mobileController){
  this.mobileController = mobileController;
  this.enabled = ! mobileController.isMobile();

  new TerminalTogglerCommand({
    enable: toggle.bind(this, true),
    disable: toggle.bind(this, false),
  });
}

ClickHandler.prototype.handle = function(clickedTerminal){
  if (this.typing){
    return;
  }

  if (clickedTerminal) {

    if (this.enabled) {
      terminal.open();
    }

    else {
      setTyping.call(this, true);
      terminal.type('page navigation')
        .then(setTyping.bind(this, false));
    }
  }
  else {
    terminal.close();
  }
};

var setTyping = function(bool){
  this.typing = bool;
};

module.exports = ClickHandler;
