var SpecialChars = require('app/terminal/input/prompt/special_chars');

var PromptController = require('app/terminal/input/prompt/controller');
var View = require('app/terminal/input/view');

function Controller($el, inputModel){
  this.input = inputModel;

  new View($el.find('.terminal-input'), this.input);

  var $prompt = $el.find('.terminal-input-prompt');
  new PromptController($prompt, inputModel.prompt);

  $el.on('keydown', keydown.bind(this));
  $el.keypress(keypress.bind(this));
}

//private, must be bound

var keydown = function(event){
  var specialChar = SpecialChars.getSpecial(event.keyCode);

  if (specialChar){
    event.preventDefault();
    this.input.special(specialChar);
  }

};

var keypress = function(event){
  event.preventDefault();

  if (SpecialChars.getSpecial(event.keyCode)) {
    return;
  }
  var typedChar = String.fromCharCode(event.charCode);

  this.input.addChar(typedChar);

};

module.exports = Controller;
