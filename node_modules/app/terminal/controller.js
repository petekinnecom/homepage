var OutputView = require('app/terminal/output/view');
var InputView = require('app/terminal/input/view');
var terminal = require('app/terminal/model');
var Maximizer = require('app/terminal/input/maximizer');


var $ = require('jquery');
//TODO: refactor this

var inputView;
function Controller($container){
  this.$container = $container;

  var $output, $input, outputView,  $hiddenInput, maximizer, inputView;

  $output = $container.find('.terminal-output');

  $input = $container.find('.terminal-input');
  $hiddenInput = $container.find('.terminal-input--hidden');

  outputView = new OutputView($output);
  inputView = new InputView($input, $hiddenInput);

  $('.terminal').on('keydown', inputView.keydown.bind(inputView));
  $('.terminal').keypress(inputView.keypress.bind(inputView));

  maximizer = new Maximizer();

  var toggle = function(event){
    maximizer.toggle(event).then(function(newState){
      inputView.terminalResized(newState);
    });
  };

  $('body').on('click', toggle);

  var minimize = function(event){
    maximizer.minimize(event).then(function(newState){
      inputView.terminalResized(newState);
    });
  };

  terminal.events.on('close', minimize);

}

module.exports = Controller;
