var EventEmitter = require('events').EventEmitter;
var commandRegistry = require('app/terminal/commands/registry');

function Processor(){
  this.events = new EventEmitter();
  this.process = this.process.bind(this);
}

Processor.prototype.process = function(input){
  var response, streamOutput;

  this.events.emit('input', input);
  streamOutput = this.events.emit.bind(this.events, 'output');

  try {
    var handler = commandRegistry.findHandler(input);
    handler.run(input, streamOutput);
  }
  catch(e) {
    streamOutput(e.message);
  }

};

module.exports = Processor;
